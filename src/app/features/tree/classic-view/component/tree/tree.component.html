<meta name="viewport" content="width=device-width, initial-scale=1.0">

<div class="side-controls">
      <div class="side-btn" routerLink="/vTree">ุงููุนูุฑุถ ุงููุชูููุงุนูููู</div>
      <div class="side-btn" routerLink="/home2">ุงูุตููุญุฉ ุงูุณุงุจููุฉ</div>
</div>

<div class="zoom-controls">
      <button (click)="zoomIn()" class="btn-zoom" title="Zoom In">
            <svg viewBox="0 0 24 24">
                  <path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
            </svg>
      </button>
      <button (click)="zoomOut()" class="btn-zoom" title="Zoom Out">
            <svg viewBox="0 0 24 24">
                  <path fill="currentColor" d="M19,13H5V11H19V13Z" />
            </svg>
      </button>
</div>

<div class="top-right-controls">
      <button class="side-btn" (click)="onSave()">ุญูุธ ุงูุดุฌุฑุฉ</button>
</div>

<!-- Container for tree layout -->
<div #treeContainer class="tree-container" [class.landscape-faded]="showOrientationHint">

      <!-- Orientation Hint Overlay -->
      <div class="orientation-hint" *ngIf="showOrientationHint" (click)="closeOrientationHint()">
            <div class="hint-content">
                  <div class="rotate-icon">
                        <svg viewBox="0 0 24 24" width="48" height="48">
                              <path fill="currentColor"
                                    d="M16.48,2.52c0.28-0.28,0.73-0.28,1.01,0l4.99,4.99c0.28,0.28,0.28,0.73,0,1.01l-4.99,4.99c-0.28,0.28-0.73,0.28-1.01,0l-0.63-0.63c-0.28-0.28-0.28-0.73,0-1.01l3.05-3.05C15.66,8.33,12.4,8.1,9.45,8.96C6.5,9.81,4.1,11.83,3.02,14.51c-0.21,0.51-0.77,0.77-1.28,0.56s-0.77-0.77-0.56-1.28C2.56,10.29,5.7,7.7,9.36,6.62c3.67-1.08,7.63-0.61,10.92,1.38l-2.43-2.43c-0.28-0.28-0.28-0.73,0-1.01L16.48,2.52z M21.54,8.93c-0.51,0.21-0.77,0.77-0.56,1.28c1.38,3.5,0.77,7.46-1.74,10.43l2.43-2.43c0.28-0.28,0.73-0.28,1.01,0l0.63,0.63c0.28,0.28,0.28,0.73,0,1.01l-4.99,4.99c-0.28,0.28-0.73,0.28-1.01,0l-4.99-4.99c-0.28-0.28-0.28-0.73,0-1.01l0.63-0.63c0.28-0.28,0.73-0.28,1.01,0l3.05,3.05c2.47-2.92,3.16-6.83,1.83-10.3c-0.21-0.51,0.05-1.07,0.56-1.28S21.75,8.72,21.54,8.93z" />
                        </svg>
                  </div>
                  <p>ูุฃูุถู ุนุฑุถ ููุดุฌุฑุฉุ ูููุถููู ุงุณุชุฎุฏุงู ุงููุงุชู ุจุงููุถุน ุงูุงููู</p>
                  <button class="hint-dismiss">ูููุช</button>
            </div>
      </div>
      <!-- Sizer for scrolling -->
      <div class="zoom-sizer" [style.width.px]="treeWidth * zoomLevel"
            [style.height.px]="(treeHeight * zoomLevel) + verticalOffset">

            <!-- Zoomed Content -->
            <div [style.transform]="'scale(' + zoomLevel + ')'"
                  style="transform-origin: 0 0; position: absolute; left:0;" [style.top.px]="verticalOffset"
                  [style.width.px]="treeWidth" [style.height.px]="treeHeight">


                  <!-- SVG Connections -->
                  <svg class="tree-svg">
                        <line *ngFor="let line of connectionLines" [attr.x1]="line.x1" [attr.y1]="line.y1"
                              [attr.x2]="line.x2" [attr.y2]="line.y2" stroke="#d4af37" stroke-width="2" />
                  </svg>

                  <!-- Family Tree Rendering -->
                  <ng-container *ngFor="let member of familyTree">
                        <ng-container *ngTemplateOutlet="renderMember; context: { $implicit: member }"></ng-container>
                  </ng-container>

            </div>

      </div>
</div>

<ng-template #renderMember let-member>



      <!-- Member Card -->
      <div class="member-card" [attr.data-id]="member.id" [style.left.px]="member.x" [style.top.px]="member.y"
            (mousedown)="startDrag($event, member)" (touchstart)="startDrag($event, member)"
            [class.selected]="selectedMember?.id === member.id">
            <p>{{ member.name }}</p>
            <!-- Add Member ุฑุญูู ุงููู for died -->
      </div>



      <!-- EDIT PANEL -->
      <div class="edit-panel" *ngIf="selectedMember?.id === member.id" [style.left.px]="member.x + 120"
            [style.top.px]="member.y + 10" [@fadeInOut]="'in'">

            <h4>ุชุนุฏูู</h4>
            <label>
                  ุงูุงุณู
                  <input [(ngModel)]="newName" />
                  <button (click)="updateName()">ุชุนุฏูู ุงูุงุณู</button>
            </label>

            <div style="margin-top: 5px">
                  <label>
                        ุงุถุงูุฉ ุงุจู
                        <input [(ngModel)]="childName" />
                        <button (click)="addNewChild()">ุงุถุงูุฉ</button>
                  </label>
            </div>
            <div style="margin-top: 5px">
                  <label>
                        <p></p>
                        <button (click)="removeSelectedChild()">ุญุฐู</button>
                  </label>
            </div>

            <div *ngIf="selectedMember && selectedMember.children && selectedMember.children.length > 0">
                  <h5>ุงูุฃุจูุงุก</h5>
                  <select [(ngModel)]="selectedMember">
                        <option *ngFor="let c of selectedMember.children" [value]="c.id">
                              {{ c.name }}
                        </option>
                  </select>
            </div>
      </div>


      <ng-container *ngFor="let child of member.children">
            <ng-container *ngTemplateOutlet="renderMember;
          context: { $implicit: child }">
            </ng-container>
      </ng-container>



</ng-template>




<!-- 
<button (click)="onSave()">
      ๐พ Save Tree
</button> -->




<div *ngIf="saveMessage" style="margin-top: 10px; color: green;">
      {{ saveMessage }}
</div>